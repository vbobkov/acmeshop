<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/* @var $this Mage_Core_Block_Template */
/* @var $catalogSearchHelper Mage_Catalogsearch_Helper_Data */
$catalogSearchHelper =  $this->helper('catalogsearch');
?>
<!--<form id="search_mini_form" action="<?php // echo $catalogSearchHelper->getResultUrl() ?>" method="get">-->
<!--
<form id="search_mini_form" action="/searchresults" method="get">
	<input type="hidden" name="order" value="relevance">
	<input type="hidden" name="dir" value="desc">
    <div class="form-search">
        <label for="search"><?php echo $this->__('Search:') ?></label>
        <input id="search" type="text" name="<?php echo $catalogSearchHelper->getQueryParamName() ?>" value="<?php echo $catalogSearchHelper->getEscapedQueryText() ?>" class="input-text" maxlength="<?php echo $catalogSearchHelper->getMaxQueryLength();?>" />
        <button type="submit" title="<?php echo $this->__('Search') ?>" class="button"><span><span><?php echo $this->__('Search') ?></span></span></button>
        <div id="search_autocomplete" class="search-autocomplete"></div>
        <script type="text/javascript">
        //<![CDATA[
            var searchForm = new Varien.searchForm('search_mini_form', 'search', '<?php echo $this->__('Search...') ?>');
            searchForm.initAutocomplete('<?php echo $catalogSearchHelper->getSuggestUrl() ?>', 'search_autocomplete');
        //]]>
        </script>
    </div>
</form>
-->

<form target="_blank" id="search_mini_form" action="https://www.google.com/search" method="get" autocomplete="off">
    <div class="form-search">
        <label for="search"><?php echo $this->__('Search:') ?></label>
        <input id="search" type="text" name="q" value="<?php echo $catalogSearchHelper->getEscapedQueryText() ?>" class="input-text" />
        <button type="submit" title="<?php echo $this->__('Search') ?>" class="button"><span><span><?php echo $this->__('Search') ?></span></span></button>
        <div id="search_autocomplete" class="search-autocomplete"></div>
    </div>
</form>

<script type="text/javascript">
	jQuery(document).ready(function() {
		// http://stackoverflow.com/questions/1909441/jquery-keyup-delay
		var delay = (function(){
			var timer = 0;
			return function(callback, ms){
				clearTimeout(timer);
				timer = setTimeout(callback, ms);
			};
		})();

		var last_input_change = 0;
		var suggest_url = '<?php echo $catalogSearchHelper->getSuggestUrl() ?>';

		jQuery('html').die('click');
		jQuery('html').live('click', function(event) {
			jQuery('#search_autocomplete').css('display', '');
		});

		jQuery('#search_mini_form #search').die('paste keyup');
		jQuery('#search_mini_form #search').live('paste keyup', function(event) {
			var input_value = jQuery(this).attr('value');
			delay(function() {
				if(input_value.length > 2) {
					jQuery.get(suggest_url + '?q=' + input_value, function(response) {
						jQuery('#search_autocomplete').html(response);
						jQuery('#search_autocomplete ul li:gt(10)').remove();
						jQuery('#search_autocomplete .amount').remove();
						jQuery('#search_autocomplete').css('display', 'inline-block');
					});
				}
			}, 500);
		});

		jQuery('#search_autocomplete ul li').die('click');
		jQuery('#search_autocomplete ul li').live('click', function(event) {
			event.stopPropagation();
			jQuery('#search_mini_form #search').attr('value', jQuery(this).text());
			jQuery('#search_mini_form button[type="submit"]').click();
		});

		jQuery('#search_mini_form button[type="submit"]').die('click');
		jQuery('#search_mini_form button[type="submit"]').live('click', function(event) {
			event.preventDefault();
			event.stopPropagation();
			var submit_form = jQuery(this).closest('form');
			var search_input = submit_form.find('#search');
			var search_input_old_value = search_input.attr('value');
			if(search_input_old_value != null && search_input_old_value.replace(/ /g, '').length > 0) {
				search_input.attr('value', 'site:acmelectronics.com ' + search_input.attr('value'));
				submit_form.trigger('submit');
				search_input.attr('value', search_input_old_value);
			}
		});
	});
</script>
